# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a WordPress installation with a **Sage theme** as the primary development theme. Sage is a modern WordPress starter theme that uses Laravel Blade templating, Tailwind CSS, and Vite for the build process.

## Key Directories

- **WordPress Core**: Root directory contains standard WordPress files
- **Active Theme**: `wp-content/themes/sage/` - Modern WordPress theme using Laravel components
- **Other Themes**: `wp-content/themes/` contains additional themes (frost, twentytwentyfive, etc.)
- **Plugins**: `wp-content/plugins/` (currently minimal)
- **Uploads**: `wp-content/uploads/` for media files

## Development Commands

All development commands should be run from the Sage theme directory: `wp-content/themes/sage/`

### Build & Development
- `npm run dev` - Start Vite development server with hot reloading
- `npm run build` - Build production assets
- `composer install` - Install PHP dependencies (required for theme to function)
- `npm install` - Install Node.js dependencies

### Code Quality
- `vendor/bin/pint` - Laravel Pint for PHP code formatting (from composer.json dev dependencies)

### Translation Commands
- `npm run translate` - Generate and update translation files
- `npm run translate:pot` - Create .pot file for translations
- `npm run translate:update` - Update existing .po files
- `npm run translate:compile` - Compile translations to .mo and .js formats

## Architecture

### Sage Theme Structure
- **App Logic**: `app/` - PHP classes using PSR-4 autoloading (`App\` namespace)
  - `app/setup.php` - Theme configuration and WordPress hooks
  - `app/filters.php` - WordPress filters
  - `app/Providers/` - Laravel-style service providers
  - `app/View/` - View composers and presenters

- **Templates**: `resources/views/` - Blade templates (.blade.php files)
  - `layouts/app.blade.php` - Main layout template
  - `sections/` - Header, footer, sidebar partials
  - `partials/` - Reusable template components
  - `components/` - Blade components

- **Assets**: `resources/` - Source files for compilation
  - `resources/css/` - Tailwind CSS files
  - `resources/js/` - JavaScript files
  - `resources/images/` - Image assets
  - `resources/fonts/` - Font files

- **Build Output**: `public/build/` - Compiled assets (generated by Vite)

### Technology Stack
- **PHP Framework**: Laravel Acorn (Laravel components for WordPress)
- **Templating**: Laravel Blade
- **CSS Framework**: Tailwind CSS v4
- **Build Tool**: Vite
- **Package Management**: Composer (PHP) + npm (Node.js)

### WordPress Integration
- Theme uses Laravel Blade instead of traditional PHP templates
- Block editor support with custom CSS/JS injection
- Theme.json generation based on Tailwind configuration
- Modern WordPress development practices with PSR-4 autoloading

## Environment Notes

### Local Development
- **Environment Type**: Local development (`WP_ENVIRONMENT_TYPE = 'local'`)
- **Database**: Local MySQL via Local by Flywheel (credentials in wp-config.php)
- **Alternative**: Docker Compose environment with MySQL container
- **Node Version**: Requires Node.js >= 20.0.0

### Production Deployment
- **Platform**: Railway.app (free tier)
- **Environment Type**: Production (`WP_ENVIRONMENT_TYPE = 'production'`)
- **Database**: Railway MySQL (managed service)
- **Configuration**: Environment variables via `wp-config-railway.php`
- **CI/CD**: GitHub Actions with Railway deployment
- **Cost**: $0/month for demo sites

## Deployment Architecture

### Railway Configuration
- **Dockerfile**: Creates production WordPress container with built themes
- **railway.toml**: Railway build configuration and health checks
- **nixpacks.toml**: Alternative build configuration (PHP + Node.js)
- **wp-config-railway.php**: Railway-specific WordPress configuration

### GitHub Actions Workflow
- **Build Process**: Automatically builds Sage theme assets during deployment
- **Asset Optimization**: Removes development files (node_modules, source files)
- **Railway Deploy**: Direct deployment to Railway platform
- **Zero Downtime**: Railway handles deployment with no interruption

### Railway Architecture
- **Application**: WordPress container running on Railway
- **Built Themes**: Pre-compiled theme assets in `wp-content/themes/`
- **Uploads**: Railway persistent storage (automatically managed)
- **Database**: Railway MySQL service (managed, persistent)

## File Naming Conventions
- Blade templates: `.blade.php` extension
- PHP classes: PSR-4 autoloading with `App\` namespace
- CSS/JS: Standard naming in `resources/` directory
- Built assets: Vite handles naming and versioning in `public/build/`
- Railway configs: `railway.toml`, `nixpacks.toml`, `Dockerfile`, `wp-config-railway.php`

## Important Commands

### Theme Development (Local)
```bash
cd wp-content/themes/sage/
npm install && composer install  # Install dependencies
npm run dev                       # Development with hot reload
npm run build                     # Production build
vendor/bin/pint                   # Code formatting
```

### Railway Development
```bash
# Install Railway CLI (optional)
npm install -g @railway/cli

# Deploy to Railway
railway up                        # Manual deployment
railway logs                      # View application logs
railway open                      # Open app in browser
```

### Deployment
```bash
git push origin main              # Triggers GitHub Actions
# → Builds theme assets
# → Cleans development files
# → Deploys to Railway
```

## Troubleshooting

### Theme Issues
- Run `composer install` if classes aren't found
- Run `npm run build` if assets aren't loading
- Check `wp-content/themes/sage/public/build/` exists

### Database Connection Issues
- Railway automatically provides `DATABASE_URL` environment variable
- Check Railway dashboard for MySQL service status
- Ensure `wp-config-railway.php` is being used in production
- Verify database service is connected to application

### Deployment Issues
- Check GitHub Actions logs for build failures
- Verify Railway token in GitHub secrets
- Check Railway dashboard deployment logs
- Ensure all services are running in Railway dashboard